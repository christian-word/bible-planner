<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–ª–∞–Ω –∏–∑—É—á–µ–Ω–∏—è –ë–∏–±–ª–∏–∏</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            height: 10px;
            margin-top: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: #27ae60;
            height: 100%;
            transition: width 0.5s ease;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ */
        .tabs {
            display: flex;
            border-bottom: 1px solid #e9ecef;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            background: #f8f9fa;
        }

        .tab.active {
            border-bottom: 3px solid #3498db;
            background: white;
            color: #3498db;
        }

        .tab-content {
            display: none;
            padding: 25px;
        }

        .tab-content.active {
            display: block;
        }

        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        .setup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .setup-item {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .setup-item h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .tag-cloud-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tag-cloud .tag {
            cursor: pointer;
            transition: transform 0.2s;
        }

        .tag-cloud .tag:hover {
            transform: scale(1.1);
        }

        .testament-section {
            margin-bottom: 40px;
        }

        .testament-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .reading-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .reading-card {
            background: #fff;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .reading-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .reading-card.completed {
            background: #d4edda;
            border-color: #27ae60;
        }

        .reading-card.overdue {
            border-color: #e74c3c;
            background: #fadbd8;
        }

        .reading-card.completed::before {
            content: "‚úì";
            position: absolute;
            top: 15px;
            right: 15px;
            background: #27ae60;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
        }

        .reading-card.overdue::after {
            content: "!";
            position: absolute;
            top: 15px;
            right: 50px;
            background: #e74c3c;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
        }

        .day-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .day-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3498db;
        }

        .day-date {
            font-size: 0.9rem;
            color: #7f8c8d;
            font-weight: 500;
        }

        .reading-text {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .reading-actions {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .custom-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #3498db;
            border-radius: 4px;
            position: relative;
            transition: all 0.3s ease;
        }

        .custom-checkbox.checked {
            background: #27ae60;
            border-color: #27ae60;
        }

        .custom-checkbox.checked::after {
            content: "‚úì";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .youversion-link {
            background: #f39c12;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .youversion-link:hover {
            background: #e67e22;
        }

        .notes-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .notes-textarea {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            resize: vertical;
            font-family: inherit;
            font-size: 0.9rem;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .tags-section {
            margin-top: 10px;
        }

        .tags-input {
            width: 100%;
            padding: 8px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .tags-display {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 8px;
        }

        .tag {
            background: #3498db;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
            position: relative;
            padding-right: 20px;
        }

        .tag.faith {
            background: #9b59b6;
        }
        .tag.love {
            background: #e74c3c;
        }
        .tag.hope {
            background: #f39c12;
        }
        .tag.salvation {
            background: #27ae60;
        }
        .tag.sin {
            background: #34495e;
        }
        .tag.prayer {
            background: #3498db;
        }

        .remove-tag {
            position: absolute;
            right: 5px;
            cursor: pointer;
        }

        .remove-tag:hover {
            color: #ffdddd;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        .today-highlight {
            border: 3px solid #f39c12;
            box-shadow: 0 0 20px rgba(243, 156, 18, 0.3);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #e74c3c;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #27ae60;
        }

        .notification.warning {
            background: #f39c12;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                padding: 12px;
                border-bottom: 1px solid #e9ecef;
            }
            
            .tab.active {
                border-left: 3px solid #3498db;
                border-bottom: none;
            }

            .reading-grid {
                grid-template-columns: 1fr;
            }

            .setup-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìñ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–ª–∞–Ω –∏–∑—É—á–µ–Ω–∏—è –ë–∏–±–ª–∏–∏</h1>
            <p>–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ –°–≤—è—â–µ–Ω–Ω–æ–≥–æ –ü–∏—Å–∞–Ω–∏—è</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <div class="tab active" onclick="showTab('plan')">üìÖ –ü–ª–∞–Ω</div>
            <div class="tab" onclick="showTab('settings')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            <div class="tab" onclick="showTab('actions')">üóëÔ∏è –î–µ–π—Å—Ç–≤–∏—è</div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–∫–∏ "–ü–ª–∞–Ω" -->
        <div id="plan-tab" class="tab-content active">
            <div class="controls">
                <div class="view-toggle">
                    <button class="btn btn-primary active" onclick="showView('all')">–í—Å–µ –¥–Ω–∏</button>
                    <button class="btn btn-secondary" onclick="showView('today')">–°–µ–≥–æ–¥–Ω—è</button>
                    <button class="btn btn-secondary" onclick="showView('week')">–ù–µ–¥–µ–ª—è</button>
                    <button class="btn btn-secondary" onclick="showView('overdue')">–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ</button>
                </div>
                <div class="tag-search">
                    <input type="text" id="tagSearchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–≥–∞–º..." class="form-control">
                    <button class="btn btn-primary" onclick="searchByTag()">–ù–∞–π—Ç–∏</button>
                    <button class="btn btn-secondary" onclick="resetSearch()">–°–±—Ä–æ—Å–∏—Ç—å</button>
                </div>
            </div>

            <div class="content">
                <div class="tag-cloud-section">
                    <h3>–û–±–ª–∞–∫–æ —Ç–µ–≥–æ–≤</h3>
                    <div class="tag-cloud" id="tagCloud"></div>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalDays">365</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –¥–Ω–µ–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completedDays">0</div>
                        <div class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="progressPercent">0%</div>
                        <div class="stat-label">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="notesCount">0</div>
                        <div class="stat-label">–ó–∞–º–µ—Ç–æ–∫</div>
                    </div>
                </div>

                <div class="testament-section">
                    <h2 class="testament-title">üìú –í–µ—Ç—Ö–∏–π –ó–∞–≤–µ—Ç</h2>
                    <div class="reading-grid" id="oldTestament"></div>
                </div>

                <div class="testament-section">
                    <h2 class="testament-title">‚úùÔ∏è –ù–æ–≤—ã–π –ó–∞–≤–µ—Ç</h2>
                    <div class="reading-grid" id="newTestament"></div>
                </div>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–∫–∏ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" -->
        <div id="settings-tab" class="tab-content">
            <div class="setup-grid">
                <div class="setup-item">
                    <h3>üìÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–∞–Ω–∞</h3>
                    <div class="form-group">
                        <label for="startDate">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:</label>
                        <input type="date" id="startDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="planType">–¢–∏–ø –ø–ª–∞–Ω–∞:</label>
                        <select id="planType" class="form-control">
                            <option value="year">–ó–∞ –≥–æ–¥ (365 –¥–Ω–µ–π)</option>
                            <option value="halfYear">–ó–∞ –ø–æ–ª–≥–æ–¥–∞ (183 –¥–Ω—è)</option>
                            <option value="chronological">–•—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π</option>
                            <option value="thematic">–¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="updatePlan()">–û–±–Ω–æ–≤–∏—Ç—å –ø–ª–∞–Ω</button>
                </div>

                <div class="setup-item">
                    <h3>üîî –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</h3>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="enableNotifications"> –í–∫–ª—é—á–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="reminderTime">–í—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:</label>
                        <input type="time" id="reminderTime" class="form-control" value="09:00">
                    </div>
                    <button class="btn btn-success" onclick="setupReminders()">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å</button>
                </div>

                <div class="setup-item">
                    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <p><strong>–ü—Ä–æ–ø—É—â–µ–Ω–æ –¥–Ω–µ–π:</strong> <span id="missedDays">0</span></p>
                    <p><strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–∑—É—á–µ–Ω–∏—è:</strong> <span id="studyDuration">0 –¥–Ω–µ–π</span></p>
                    <p><strong>–°—Ä–µ–¥–Ω–∏–π —Ç–µ–º–ø:</strong> <span id="averagePace">0%</span></p>
                </div>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–∫–∏ "–î–µ–π—Å—Ç–≤–∏—è" -->
        <div id="actions-tab" class="tab-content">
            <div class="setup-grid">
                <div class="setup-item">
                    <h3>üíæ –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–º–µ—Ç–æ–∫</h3>
                    <p>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤—Å–µ –≤–∞—à–∏ –∑–∞–º–µ—Ç–∫–∏ –≤ —Ñ–∞–π–ª —Ñ–æ—Ä–º–∞—Ç–∞ Markdown</p>
                    <button class="btn btn-warning" onclick="exportNotes()">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–º–µ—Ç–∫–∏</button>
                </div>
                
                <div class="setup-item">
                    <h3>üîÅ –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</h3>
                    <p>–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –æ—Ç–º–µ—Ç–∫–∏ –æ –ø—Ä–æ—á—Ç–µ–Ω–∏–∏</p>
                    <button class="btn btn-secondary" onclick="resetProgress()">–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
                </div>
                
                <div class="setup-item">
                    <h3>üóëÔ∏è –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h3>
                    <p>–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–æ–≥—Ä–µ—Å—Å, –∑–∞–º–µ—Ç–∫–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)</p>
                    <button class="btn btn-danger" onclick="clearAllData()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
// –ü–ª–∞–Ω—ã —á—Ç–µ–Ω–∏—è
const readingPlans = {
    year: {
        oldTestament: [
            { day: 1, text: "–ë—ã—Ç–∏–µ 1-3" },
            { day: 2, text: "–ë—ã—Ç–∏–µ 4-7" },
            { day: 3, text: "–ë—ã—Ç–∏–µ 8-11" },
            { day: 4, text: "–ë—ã—Ç–∏–µ 12-15" },
            { day: 5, text: "–ë—ã—Ç–∏–µ 16-19" },
            { day: 6, text: "–ë—ã—Ç–∏–µ 20-23" },
            { day: 7, text: "–ë—ã—Ç–∏–µ 24-27" },
            { day: 8, text: "–ë—ã—Ç–∏–µ 28-31" },
            { day: 9, text: "–ë—ã—Ç–∏–µ 32-35" },
            { day: 10, text: "–ë—ã—Ç–∏–µ 36-39" },
            { day: 11, text: "–ë—ã—Ç–∏–µ 40-43" },
            { day: 12, text: "–ë—ã—Ç–∏–µ 44-47" },
            { day: 13, text: "–ë—ã—Ç–∏–µ 48-50" },
            { day: 14, text: "–ò—Å—Ö–æ–¥ 1-4" },
            { day: 15, text: "–ò—Å—Ö–æ–¥ 5-8" },
            { day: 16, text: "–ò—Å—Ö–æ–¥ 9-12" },
            { day: 17, text: "–ò—Å—Ö–æ–¥ 13-16" },
            { day: 18, text: "–ò—Å—Ö–æ–¥ 17-20" },
            { day: 19, text: "–ò—Å—Ö–æ–¥ 21-24" },
            { day: 20, text: "–ò—Å—Ö–æ–¥ 25-28" }
        ],
        newTestament: [
            { day: 1, text: "–ú–∞—Ç—Ñ–µ—è 1-2" },
            { day: 2, text: "–ú–∞—Ç—Ñ–µ—è 3-4" },
            { day: 3, text: "–ú–∞—Ç—Ñ–µ—è 5-7" },
            { day: 4, text: "–ú–∞—Ç—Ñ–µ—è 8-10" },
            { day: 5, text: "–ú–∞—Ç—Ñ–µ—è 11-13" },
            { day: 6, text: "–ú–∞—Ç—Ñ–µ—è 14-16" },
            { day: 7, text: "–ú–∞—Ç—Ñ–µ—è 17-19" },
            { day: 8, text: "–ú–∞—Ç—Ñ–µ—è 20-22" },
            { day: 9, text: "–ú–∞—Ç—Ñ–µ—è 23-25" },
            { day: 10, text: "–ú–∞—Ç—Ñ–µ—è 26-28" },
            { day: 11, text: "–ú–∞—Ä–∫–∞ 1-3" },
            { day: 12, text: "–ú–∞—Ä–∫–∞ 4-6" },
            { day: 13, text: "–ú–∞—Ä–∫–∞ 7-9" },
            { day: 14, text: "–ú–∞—Ä–∫–∞ 10-12" },
            { day: 15, text: "–ú–∞—Ä–∫–∞ 13-16" },
            { day: 16, text: "–õ—É–∫–∏ 1-3" },
            { day: 17, text: "–õ—É–∫–∏ 4-6" },
            { day: 18, text: "–õ—É–∫–∏ 7-9" },
            { day: 19, text: "–õ—É–∫–∏ 10-12" },
            { day: 20, text: "–õ—É–∫–∏ 13-15" }
        ]
    },
    halfYear: {
        oldTestament: [
            { day: 1, text: "–ë—ã—Ç–∏–µ 1-6" },
            { day: 2, text: "–ë—ã—Ç–∏–µ 7-14" },
            { day: 3, text: "–ë—ã—Ç–∏–µ 15-22" },
            { day: 4, text: "–ë—ã—Ç–∏–µ 23-31" },
            { day: 5, text: "–ë—ã—Ç–∏–µ 32-39" },
            { day: 6, text: "–ë—ã—Ç–∏–µ 40-50" },
            { day: 7, text: "–ò—Å—Ö–æ–¥ 1-8" },
            { day: 8, text: "–ò—Å—Ö–æ–¥ 9-16" },
            { day: 9, text: "–ò—Å—Ö–æ–¥ 17-24" },
            { day: 10, text: "–ò—Å—Ö–æ–¥ 25-32" }
        ],
        newTestament: [
            { day: 1, text: "–ú–∞—Ç—Ñ–µ—è 1-4" },
            { day: 2, text: "–ú–∞—Ç—Ñ–µ—è 5-10" },
            { day: 3, text: "–ú–∞—Ç—Ñ–µ—è 11-16" },
            { day: 4, text: "–ú–∞—Ç—Ñ–µ—è 17-22" },
            { day: 5, text: "–ú–∞—Ç—Ñ–µ—è 23-28" },
            { day: 6, text: "–ú–∞—Ä–∫–∞ 1-6" },
            { day: 7, text: "–ú–∞—Ä–∫–∞ 7-12" },
            { day: 8, text: "–ú–∞—Ä–∫–∞ 13-16" },
            { day: 9, text: "–õ—É–∫–∏ 1-6" },
            { day: 10, text: "–õ—É–∫–∏ 7-12" }
        ]
    },
    chronological: {
        oldTestament: [
            { day: 1, text: "–ë—ã—Ç–∏–µ 1-2 (–°–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ)" },
            { day: 2, text: "–ë—ã—Ç–∏–µ 3-5 (–ì—Ä–µ—Ö–æ–ø–∞–¥–µ–Ω–∏–µ)" },
            { day: 3, text: "–ë—ã—Ç–∏–µ 6-9 (–ü–æ—Ç–æ–ø)" },
            { day: 4, text: "–ë—ã—Ç–∏–µ 10-11 (–í–∞–≤–∏–ª–æ–Ω)" },
            { day: 5, text: "–ò–æ–≤ 1-7 (–ò—Å–ø—ã—Ç–∞–Ω–∏—è –ò–æ–≤–∞)" },
            { day: 6, text: "–ò–æ–≤ 8-14" },
            { day: 7, text: "–ò–æ–≤ 15-21" },
            { day: 8, text: "–ò–æ–≤ 22-28" },
            { day: 9, text: "–ò–æ–≤ 29-35" },
            { day: 10, text: "–ò–æ–≤ 36-42" }
        ],
        newTestament: [
            { day: 1, text: "–ú–∞—Ç—Ñ–µ—è 1-2 (–†–æ–∂–¥–µ–Ω–∏–µ –•—Ä–∏—Å—Ç–∞)" },
            { day: 2, text: "–õ—É–∫–∏ 1-2 (–ë–ª–∞–≥–æ–≤–µ—â–µ–Ω–∏–µ)" },
            { day: 3, text: "–ú–∞—Ç—Ñ–µ—è 3-4 (–ù–∞—á–∞–ª–æ —Å–ª—É–∂–µ–Ω–∏—è)" },
            { day: 4, text: "–ò–æ–∞–Ω–Ω–∞ 1-3 (–ü–µ—Ä–≤—ã–µ —É—á–µ–Ω–∏–∫–∏)" },
            { day: 5, text: "–ú–∞—Ç—Ñ–µ—è 5-7 (–ù–∞–≥–æ—Ä–Ω–∞—è –ø—Ä–æ–ø–æ–≤–µ–¥—å)" },
            { day: 6, text: "–ú–∞—Ç—Ñ–µ—è 8-10 (–ß—É–¥–µ—Å–∞ –∏ —É—á–µ–Ω–∏–∫–∏)" },
            { day: 7, text: "–ú–∞—Ä–∫–∞ 1-3 (–°–ª—É–∂–µ–Ω–∏–µ –≤ –ì–∞–ª–∏–ª–µ–µ)" },
            { day: 8, text: "–ú–∞—Ä–∫–∞ 4-6 (–ü—Ä–∏—Ç—á–∏ –∏ —á—É–¥–µ—Å–∞)" },
            { day: 9, text: "–õ—É–∫–∏ 7-9 (–£—á–µ–Ω–∏–µ –∏ –∏—Å—Ü–µ–ª–µ–Ω–∏—è)" },
            { day: 10, text: "–ò–æ–∞–Ω–Ω–∞ 4-6 (–°–∞–º–∞—Ä—è–Ω–∫–∞, —Ö–ª–µ–± –∂–∏–∑–Ω–∏)" }
        ]
    },
    thematic: {
        oldTestament: [
            { day: 1, text: "–ü—Å–∞–ª–æ–º 1, 23, 90 (–î–æ–≤–µ—Ä–∏–µ –ë–æ–≥—É)" },
            { day: 2, text: "–ü—Ä–∏—Ç—á–∏ 1-3 (–ú—É–¥—Ä–æ—Å—Ç—å)" },
            { day: 3, text: "–ï–∫–∫–ª–µ—Å–∏–∞—Å—Ç 3, 12 (–í—Ä–µ–º—è –∏ –≤–µ—á–Ω–æ—Å—Ç—å)" },
            { day: 4, text: "–ò—Å–∞–∏—è 40, 53, 55 (–ú–µ—Å—Å–∏—è)" },
            { day: 5, text: "–ü—Å–∞–ª–º—ã 42, 46, 84 (–ñ–∞–∂–¥–∞ –ë–æ–≥–∞)" },
            { day: 6, text: "–ò–µ—Ä–µ–º–∏—è 1, 29, 31 (–ü—Ä–∏–∑–≤–∞–Ω–∏–µ –ø—Ä–æ—Ä–æ–∫–∞)" },
            { day: 7, text: "–ò–µ–∑–µ–∫–∏–∏–ª—å 34, 36, 37 (–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ)" },
            { day: 8, text: "–î–∞–Ω–∏–∏–ª 1-3 (–í–µ—Ä–Ω–æ—Å—Ç—å –≤ –∏—Å–ø—ã—Ç–∞–Ω–∏—è—Ö)" },
            { day: 9, text: "–û—Å–∏—è 1-3, 11 (–õ—é–±–æ–≤—å –ë–æ–≥–∞)" },
            { day: 10, text: "–ú–∞–ª–∞—Ö–∏—è 3-4 (–ü–æ–∫–∞—è–Ω–∏–µ)" }
        ],
        newTestament: [
            { day: 1, text: "–ú–∞—Ç—Ñ–µ—è 5-7 (–ó–∞–ø–æ–≤–µ–¥–∏ –±–ª–∞–∂–µ–Ω—Å—Ç–≤–∞)" },
            { day: 2, text: "–ò–æ–∞–Ω–Ω–∞ 3, 10 (–°–ø–∞—Å–µ–Ω–∏–µ, –¥–æ–±—Ä—ã–π –ø–∞—Å—Ç—ã—Ä—å)" },
            { day: 3, text: "–†–∏–º–ª—è–Ω–∞–º 8 (–ñ–∏–∑–Ω—å –≤ –î—É—Ö–µ)" },
            { day: 4, text: "1 –ö–æ—Ä–∏–Ω—Ñ—è–Ω–∞–º 13 (–õ—é–±–æ–≤—å)" },
            { day: 5, text: "–ï—Ñ–µ—Å—è–Ω–∞–º 6 (–î—É—Ö–æ–≤–Ω–∞—è –±—Ä–∞–Ω—å)" },
            { day: 6, text: "–§–∏–ª–∏–ø–ø–∏–π—Ü–∞–º 2-4 (–†–∞–¥–æ—Å—Ç—å –≤ –ì–æ—Å–ø–æ–¥–µ)" },
            { day: 7, text: "–ö–æ–ª–æ—Å—Å—è–Ω–∞–º 3 (–ù–æ–≤–∞—è –∂–∏–∑–Ω—å)" },
            { day: 8, text: "–ï–≤—Ä–µ—è–º 11 (–í–µ—Ä–∞)" },
            { day: 9, text: "–ò–∞–∫–æ–≤–∞ 1-2 (–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –≤–µ—Ä–∞)" },
            { day: 10, text: "1 –ü–µ—Ç—Ä–∞ 1-2 (–ù–∞–¥–µ–∂–¥–∞)" }
        ]
    }
};

let currentPlan = readingPlans.year;
let completedReadings = {};
let notes = {};
let tags = {};
let startDate = new Date();
let currentView = 'all';
let reminderInterval = null;

// –¶–≤–µ—Ç–∞ —Ç–µ–≥–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
const tagColors = {
    '–≤–µ—Ä–∞': 'faith',
    '–ª—é–±–æ–≤—å': 'love',
    '–Ω–∞–¥–µ–∂–¥–∞': 'hope',
    '—Å–ø–∞—Å–µ–Ω–∏–µ': 'salvation',
    '–≥—Ä–µ—Ö': 'sin',
    '–º–æ–ª–∏—Ç–≤–∞': 'prayer',
    '–ø–æ–∫–∞—è–Ω–∏–µ': 'salvation',
    '—Ç–µ—Ä–ø–µ–Ω–∏–µ': 'hope',
    '–º—É–¥—Ä–æ—Å—Ç—å': 'faith',
    '–∑–∞–ø–æ–≤–µ–¥–∏': 'prayer'
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
function init() {
    loadSettings();
    loadProgress();
    loadNotes();
    setupUI();
    renderReadingPlan();
    updateStats();
    updateProgressBar();
    checkMissedReadings();
    updateTagCloud();
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
function loadSettings() {
    try {
        const savedData = localStorage.getItem('bibleSettings');
        if (savedData) {
            const settings = JSON.parse(savedData);
            startDate = settings.startDate ? new Date(settings.startDate) : new Date();
            document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
            
            const planType = settings.planType || 'year';
            document.getElementById('planType').value = planType;
            currentPlan = readingPlans[planType];
            
            document.getElementById('enableNotifications').checked = settings.notifications || false;
            document.getElementById('reminderTime').value = settings.reminderTime || '09:00';
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
    }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
function saveSettings() {
    try {
        const settings = {
            startDate: startDate.toISOString(),
            planType: document.getElementById('planType').value,
            notifications: document.getElementById('enableNotifications').checked,
            reminderTime: document.getElementById('reminderTime').value
        };
        localStorage.setItem('bibleSettings', JSON.stringify(settings));
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
function loadProgress() {
    try {
        const savedData = localStorage.getItem('bibleProgress');
        if (savedData) {
            const progress = JSON.parse(savedData);
            completedReadings = progress.completedReadings || {};
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:', error);
    }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
function saveProgress() {
    try {
        const progress = {
            completedReadings: completedReadings,
            lastUpdate: new Date().toISOString()
        };
        localStorage.setItem('bibleProgress', JSON.stringify(progress));
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:', error);
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–º–µ—Ç–æ–∫
function loadNotes() {
    try {
        const savedData = localStorage.getItem('bibleNotes');
        if (savedData) {
            const parsedData = JSON.parse(savedData);
            notes = parsedData.notes || {};
            tags = parsedData.tags || {};
        }
        updateTagCloud(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±–ª–∞–∫–æ —Ç–µ–≥–æ–≤ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–º–µ—Ç–æ–∫:', error);
        notes = {};
        tags = {};
    }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫
function saveNotes() {
    try {
        const data = {
            notes: notes,
            tags: tags,
            lastUpdate: new Date().toISOString()
        };
        localStorage.setItem('bibleNotes', JSON.stringify(data));
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–º–µ—Ç–æ–∫:', error);
    }
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
function setupUI() {
    document.getElementById('startDate').addEventListener('change', function() {
        startDate = new Date(this.value);
        saveSettings();
        renderReadingPlan();
    });
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞—Ç—ã –¥–ª—è –¥–Ω—è
function getDateForDay(day) {
    const date = new Date(startDate);
    date.setDate(date.getDate() + day - 1);
    return date;
}

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
function formatDate(date) {
    return date.toLocaleDateString('ru-RU', { 
        day: 'numeric', 
        month: 'short' 
    });
}

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —á—Ç–µ–Ω–∏—è
function createReadingCard(reading, testament) {
    const readingDate = getDateForDay(reading.day);
    const today = new Date();
    const isCompleted = completedReadings[`${testament}-${reading.day}`];
    const isToday = readingDate.toDateString() === today.toDateString();
    const isOverdue = readingDate < today && !isCompleted;
    
    const card = document.createElement('div');
    card.className = `reading-card ${isCompleted ? 'completed' : ''} ${isToday ? 'today-highlight' : ''} ${isOverdue ? 'overdue' : ''}`;
    card.setAttribute('data-day', reading.day);
    card.setAttribute('data-testament', testament);
    
    const noteKey = `${testament}-${reading.day}`;
    const noteText = notes[noteKey] || '';
    const noteTags = tags[noteKey] || [];
    
    // –°–æ–∑–¥–∞–Ω–∏–µ YouVersion —Å—Å—ã–ª–∫–∏
    const youVersionUrl = createYouVersionLink(reading.text);
    
    card.innerHTML = `
        <div class="day-info">
            <div class="day-number">–î–µ–Ω—å ${reading.day}</div>
            <div class="day-date">${formatDate(readingDate)}</div>
        </div>
        <div class="reading-text">${reading.text}</div>
        <div class="reading-actions">
            <div class="checkbox-wrapper" onclick="toggleReading('${testament}', ${reading.day})">
                <div class="custom-checkbox ${isCompleted ? 'checked' : ''}"></div>
                <span>–ü—Ä–æ—á–∏—Ç–∞–Ω–æ</span>
            </div>
            <a href="${youVersionUrl}" target="_blank" class="youversion-link">YouVersion</a>
        </div>
<div class="notes-section">
    <textarea class="notes-textarea" placeholder="–í–∞—à–∏ –∑–∞–º–µ—Ç–∫–∏ –∫ —ç—Ç–æ–º—É –æ—Ç—Ä—ã–≤–∫—É..."
        onchange="saveNote('${testament}', ${reading.day}, this.value)">${noteText}</textarea>
    <div class="tags-section">
        <div style="display:flex; gap:5px;">
            <input type="text" class="tags-input" placeholder="–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)"
                id="tag-input-${testament}-${reading.day}"
                value="${noteTags.join(', ')}">
            <button class="btn btn-primary" style="padding: 5px 10px;" onclick="saveTags('${testament}', ${reading.day})">üíæ</button>
        </div>
        <div class="tags-display">
            ${noteTags.map(tag => {
                const tagClass = tagColors[tag.toLowerCase()] || '';
                return `<span class="tag ${tagClass}">${tag}<span class="remove-tag" onclick="removeTag('${testament}', ${reading.day}, '${tag}')">√ó</span></span>`;
            }).join('')}
        </div>
    </div>
</div>

    `;
    
    return card;
}

// –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ YouVersion
function createYouVersionLink(text) {
    const bookMap = {
        '–ë—ã—Ç–∏–µ': 'GEN',
        '–ò—Å—Ö–æ–¥': 'EXO',
        '–õ–µ–≤–∏—Ç': 'LEV',
        '–ß–∏—Å–ª–∞': 'NUM',
        '–í—Ç–æ—Ä–æ–∑–∞–∫–æ–Ω–∏–µ': 'DEU',
        '–ú–∞—Ç—Ñ–µ—è': 'MAT',
        '–ú–∞—Ä–∫–∞': 'MRK',
        '–õ—É–∫–∏': 'LUK',
        '–ò–æ–∞–Ω–Ω–∞': 'JHN',
        '–î–µ—è–Ω–∏—è': 'ACT',
        '–†–∏–º–ª—è–Ω–∞–º': 'ROM',
        '–ö–æ—Ä–∏–Ω—Ñ—è–Ω–∞–º': 'CO'
    };
    
    const bookMatch = text.match(/^([–∞-—è—ë\s\d]+)/i);
    if (bookMatch) {
        const bookName = bookMatch[1].trim();
        const bookCode = Object.keys(bookMap).find(key => bookName.includes(key));
        if (bookCode) {
            const chapters = text.match(/(\d+(?:-\d+)?)/g);
            if (chapters) {
                const chapter = chapters[0].split('-')[0];
                return `https://www.bible.com/bible/143/${bookMap[bookCode]}.${chapter}.RUSV`;
            }
        }
    }
    
    return 'https://www.bible.com/ru';
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–ª–∞–Ω–∞ —á—Ç–µ–Ω–∏—è
function renderReadingPlan() {
    const oldTestamentContainer = document.getElementById('oldTestament');
    const newTestamentContainer = document.getElementById('newTestament');
    
    oldTestamentContainer.innerHTML = '';
    newTestamentContainer.innerHTML = '';
    
    const oldTestamentReadings = getFilteredReadings(currentPlan.oldTestament);
    const newTestamentReadings = getFilteredReadings(currentPlan.newTestament);
    
    oldTestamentReadings.forEach(reading => {
        const card = createReadingCard(reading, 'old');
        oldTestamentContainer.appendChild(card);
    });
    
    newTestamentReadings.forEach(reading => {
        const card = createReadingCard(reading, 'new');
        newTestamentContainer.appendChild(card);
    });
}

// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á—Ç–µ–Ω–∏–π –ø–æ —Ç–µ–∫—É—â–µ–º—É –≤–∏–¥—É
function getFilteredReadings(readings) {
    const today = new Date();
    
    switch (currentView) {
        case 'today':
            return readings.filter(reading => {
                const readingDate = getDateForDay(reading.day);
                return readingDate.toDateString() === today.toDateString();
            });
        case 'week':
            return readings.filter(reading => {
                const readingDate = getDateForDay(reading.day);
                const weekFromNow = new Date(today);
                weekFromNow.setDate(weekFromNow.getDate() + 7);
                return readingDate >= today && readingDate <= weekFromNow;
            });
        case 'overdue':
            return readings.filter(reading => {
                const readingDate = getDateForDay(reading.day);
                const isCompleted = completedReadings[`old-${reading.day}`] || completedReadings[`new-${reading.day}`];
                return readingDate < today && !isCompleted;
            });
        default:
            return readings;
    }
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á—Ç–µ–Ω–∏—è
function toggleReading(testament, day) {
    const key = `${testament}-${day}`;
    
    if (completedReadings[key]) {
        delete completedReadings[key];
    } else {
        completedReadings[key] = true;
    }
    
    saveProgress();
    renderReadingPlan();
    updateStats();
    updateProgressBar();
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏
function saveNote(testament, day, noteText) {
    const key = `${testament}-${day}`;
    if (noteText.trim()) {
        notes[key] = noteText.trim();
    } else {
        delete notes[key];
    }
    saveNotes();
    updateStats();
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ —Ç–µ–≥–æ–≤
function handleTagInput(event, testament, day) {
    if (event.key === 'Enter') {
        const key = `${testament}-${day}`;
        const tagText = event.target.value;
        const newTags = tagText.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0);
        
        tags[key] = newTags;
        saveNotes();
        renderReadingPlan();
        updateStats();
        updateTagCloud();
    }
}

// –£–¥–∞–ª–µ–Ω–∏–µ —Ç–µ–≥–∞
function removeTag(testament, day, tagToRemove) {
    const key = `${testament}-${day}`;
    if (tags[key]) {
        tags[key] = tags[key].filter(tag => tag !== tagToRemove);
        saveNotes();
        renderReadingPlan();
        updateTagCloud();
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±–ª–∞–∫–∞ —Ç–µ–≥–æ–≤
function updateTagCloud() {
    const tagCloud = document.getElementById('tagCloud');
    tagCloud.innerHTML = '';

    // –°—á–∏—Ç–∞–µ–º —á–∞—Å—Ç–æ—Ç—É —Ç–µ–≥–æ–≤
    const tagFrequency = {};
    Object.values(tags).forEach(tagList => {
        tagList.forEach(tag => {
            tagFrequency[tag] = (tagFrequency[tag] || 0) + 1;
        });
    });

    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏ –≤—ã–≤–æ–¥–∏–º
    const sortedTags = Object.keys(tagFrequency).sort((a, b) => tagFrequency[b] - tagFrequency[a]);
    sortedTags.forEach(tag => {
        const tagElement = document.createElement('span');
        tagElement.className = 'tag';
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å —Ü–≤–µ—Ç–∞, –µ—Å–ª–∏ –æ–Ω –æ–ø—Ä–µ–¥–µ–ª–µ–Ω
        const tagClass = tagColors[tag.toLowerCase()] || '';
        if (tagClass) {
            tagElement.classList.add(tagClass);
        }
        tagElement.textContent = tag;
        tagElement.style.fontSize = `${14 + tagFrequency[tag] * 2}px`;
        tagElement.onclick = () => {
            document.getElementById('tagSearchInput').value = tag;
            searchByTag();
        };
        tagCloud.appendChild(tagElement);
    });
}

// –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–≥–∞–º
function searchByTag() {
    const searchTerm = document.getElementById('tagSearchInput').value.trim().toLowerCase();
    if (!searchTerm) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥ –¥–ª—è –ø–æ–∏—Å–∫–∞', 'warning');
        return;
    }

    const allCards = document.querySelectorAll('.reading-card');
    let foundCount = 0;

    allCards.forEach(card => {
        const day = card.getAttribute('data-day');
        const testament = card.getAttribute('data-testament');
        const noteKey = `${testament}-${day}`;
        const cardTags = tags[noteKey] || [];

        if (cardTags.some(tag => tag.toLowerCase().includes(searchTerm))) {
            card.style.display = 'block';
            foundCount++;
        } else {
            card.style.display = 'none';
        }
    });

    showNotification(`–ù–∞–π–¥–µ–Ω–æ –æ—Ç—Ä—ã–≤–∫–æ–≤: ${foundCount}`, foundCount ? 'success' : 'warning');
}

// –°–±—Ä–æ—Å –ø–æ–∏—Å–∫–∞
function resetSearch() {
    document.getElementById('tagSearchInput').value = '';
    const allCards = document.querySelectorAll('.reading-card');
    allCards.forEach(card => card.style.display = 'block');
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function updateStats() {
    const totalReadings = currentPlan.oldTestament.length + currentPlan.newTestament.length;
    const completedCount = Object.keys(completedReadings).length;
    const progressPercent = Math.round((completedCount / totalReadings) * 100);
    const notesCount = Object.keys(notes).length;
    
    document.getElementById('totalDays').textContent = totalReadings;
    document.getElementById('completedDays').textContent = completedCount;
    document.getElementById('progressPercent').textContent = progressPercent + '%';
    document.getElementById('notesCount').textContent = notesCount;
    
    // –ü–æ–¥—Å—á–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –¥–Ω–µ–π
    const today = new Date();
    let missedCount = 0;
    const allReadings = [...currentPlan.oldTestament, ...currentPlan.newTestament];
    
    allReadings.forEach(reading => {
        const readingDate = getDateForDay(reading.day);
        const testament = currentPlan.oldTestament.includes(reading) ? 'old' : 'new';
        const isCompleted = completedReadings[`${testament}-${reading.day}`];
        
        if (readingDate < today && !isCompleted) {
            missedCount++;
        }
    });
    
    document.getElementById('missedDays').textContent = missedCount;
    
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑—É—á–µ–Ω–∏—è
    const studyStartDate = startDate;
    const daysDiff = Math.floor((today - studyStartDate) / (1000 * 60 * 60 * 24));
    document.getElementById('studyDuration').textContent = `${daysDiff} –¥–Ω–µ–π`;
    
    const averagePace = daysDiff > 0 ? Math.round((completedCount / daysDiff) * 100) : 0;
    document.getElementById('averagePace').textContent = `${averagePace}%`;
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
function updateProgressBar() {
    const totalReadings = currentPlan.oldTestament.length + currentPlan.newTestament.length;
    const completedCount = Object.keys(completedReadings).length;
    const progressPercent = (completedCount / totalReadings) * 100;
    
    document.getElementById('progressFill').style.width = progressPercent + '%';
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∞
function showView(view) {
    currentView = view;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
    document.querySelectorAll('.view-toggle .btn').forEach(btn => {
        btn.classList.remove('active');
        btn.classList.add('btn-secondary');
        btn.classList.remove('btn-primary');
    });
    
    event.target.classList.add('active');
    event.target.classList.add('btn-primary');
    event.target.classList.remove('btn-secondary');
    
    renderReadingPlan();
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
function showTab(tabName) {
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –≤–∫–ª–∞–¥–æ–∫
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é –≤–∫–ª–∞–¥–∫—É
    document.getElementById(`${tabName}-tab`).classList.add('active');
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –Ω—É–∂–Ω—É—é –∫–Ω–æ–ø–∫—É
    event.target.classList.add('active');
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞
function updatePlan() {
    const planType = document.getElementById('planType').value;
    const newStartDate = new Date(document.getElementById('startDate').value);
    
    currentPlan = readingPlans[planType];
    startDate = newStartDate;
    
    saveSettings();
    renderReadingPlan();
    updateStats();
    updateProgressBar();
    updateTagCloud();
    
    showNotification('–ü–ª–∞–Ω –æ–±–Ω–æ–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
function setupReminders() {
    const enabled = document.getElementById('enableNotifications').checked;
    const time = document.getElementById('reminderTime').value;
    
    if (reminderInterval) {
        clearInterval(reminderInterval);
        reminderInterval = null;
    }
    
    if (enabled) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
        reminderInterval = setInterval(() => {
            const now = new Date();
            const currentTime = now.getHours().toString().padStart(2, '0') + ':' + 
                              now.getMinutes().toString().padStart(2, '0');
            
            if (currentTime === time) {
                checkMissedReadings();
            }
        }, 60000);
        
        showNotification('–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã!', 'success');
    } else {
        showNotification('–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã', 'warning');
    }
    
    saveSettings();
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —á—Ç–µ–Ω–∏–π
function checkMissedReadings() {
    const today = new Date();
    let missedReadings = [];
    
    const allReadings = [
        ...currentPlan.oldTestament.map(r => ({...r, testament: 'old'})),
        ...currentPlan.newTestament.map(r => ({...r, testament: 'new'}))
    ];
    
    allReadings.forEach(reading => {
        const readingDate = getDateForDay(reading.day);
        const isCompleted = completedReadings[`${reading.testament}-${reading.day}`];
        
        if (readingDate < today && !isCompleted) {
            missedReadings.push(reading);
        }
    });
    
    if (missedReadings.length > 0 && document.getElementById('enableNotifications').checked) {
        showNotification(`–£ –≤–∞—Å ${missedReadings.length} –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —á—Ç–µ–Ω–∏–π`, 'warning');
    }
}

// –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
function showNotification(message, type = 'info') {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.className = `notification ${type}`;
    notification.classList.add('show');
    
    setTimeout(() => {
        notification.classList.remove('show');
    }, 3000);
}

// –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
function clearAllData() {
    if (confirm("–û—á–∏—Å—Ç–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ (–ø—Ä–æ–≥—Ä–µ—Å—Å, –∑–∞–º–µ—Ç–∫–∏, —Ç–µ–≥–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)?")) {
        localStorage.clear();
        completedReadings = {};
        notes = {};
        tags = {};
        saveProgress();
        saveNotes();
        saveSettings();
        location.reload();
    }
}

// –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
function resetProgress() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å?')) {
        completedReadings = {};
        saveProgress();
        renderReadingPlan();
        updateStats();
        updateProgressBar();
        showNotification('–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω', 'warning');
    }
}

// –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–º–µ—Ç–æ–∫
function exportNotes() {
    if (Object.keys(notes).length === 0) {
        showNotification('–ù–µ—Ç –∑–∞–º–µ—Ç–æ–∫ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'warning');
        return;
    }
    
    let exportText = '# –ó–∞–º–µ—Ç–∫–∏ –∫ –∏–∑—É—á–µ–Ω–∏—é –ë–∏–±–ª–∏–∏\n\n';
    exportText += `–≠–∫—Å–ø–æ—Ä—Ç —Å–æ–∑–¥–∞–Ω: ${new Date().toLocaleDateString('ru-RU')}\n\n`;
    
    Object.keys(notes).forEach(key => {
        const [testament, day] = key.split('-');
        const testamentName = testament === 'old' ? '–í–µ—Ç—Ö–∏–π –ó–∞–≤–µ—Ç' : '–ù–æ–≤—ã–π –ó–∞–≤–µ—Ç';
        const readingText = testament === 'old' 
            ? currentPlan.oldTestament.find(r => r.day == day)?.text 
            : currentPlan.newTestament.find(r => r.day == day)?.text;
        
        exportText += `## –î–µ–Ω—å ${day} - ${testamentName}\n`;
        exportText += `**–û—Ç—Ä—ã–≤–æ–∫:** ${readingText}\n\n`;
        exportText += `**–ó–∞–º–µ—Ç–∫–∏:** ${notes[key]}\n\n`;
        
        if (tags[key] && tags[key].length > 0) {
            exportText += `**–¢–µ–≥–∏:** ${tags[key].join(', ')}\n\n`;
        }
        
        exportText += '---\n\n';
    });
    
    // –°–æ–∑–¥–∞–µ–º –∏ —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
    const blob = new Blob([exportText], { type: 'text/markdown' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `bible_notes_${new Date().toISOString().split('T')[0]}.md`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
    
    showNotification('–ó–∞–º–µ—Ç–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
}

function saveTags(testament, day) {
    const key = `${testament}-${day}`;
    const input = document.getElementById(`tag-input-${testament}-${day}`);
    const tagText = input.value;
    const newTags = tagText.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0);

    tags[key] = newTags;
    saveNotes();
    renderReadingPlan();
    updateStats();
    updateTagCloud();
}
// –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
